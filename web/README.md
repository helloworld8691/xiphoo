# Xiphoo Web App 


## Local development

After running command below, open http://localhost:8080 (or computer IP for outside access) to view the app in the browser.

`npm start -- --secure`

"Secure" option is necessary because WebNFC works only with HTTPS connection (See Configuring HTTPS section below)
By local start app always runs in DEV environment. If local run as PROD is necessary, this can be change by changing EVN variable before scropt run (see package.js)

## Deployment

App is published over Firebase service. There are tow projects configured, DEV and PROD. 
Deploy to each accordingly:

`npm run deploy:dev`
`npm run deploy:prod`

Each deploy is automatically commented with a current HEAD hash of the app repo, for tracking.

Production version is uploaded to http://scan.xiphoo.com
Dev version is uploaded to: https://xiphoo-dev.web.app/

Technical: 

*Snowpack packages app in the web/build folder, but firebase upload is configured in a higher-level /public folder*
*This is why an intemediate step is required to copy from build to public* 
*This is a bit awkward and I think this is because of initial misconfiguration and it could be probably changed but it will still require efforts* 


### Versioning

Before deployment to official release, app version should be increased in config.ts

### Previews 

Previews are temporary (expiring) instances which can be used to quick feature testing. 

`npm run deploy:dev:preview`
`npm run deploy:prod:preview`

Particular preview URL is generated after upload. 

## Configuration

### Firebase 

To configure deployment one need to get firebase account and configure command line access by:
https://firebase.google.com/docs/cli

Use `firebase login` to verify local configuration worked.

### Configuring HTTPS

It requires for self-signed certificates named `snopack.crt`and `snowpack.key`
to be available in the root folder (see https://www.snowpack.dev/guides/https-ssl-certificates)

This repository includes these files however I am not sure they will work on each machine. 
In emergency case they can be regenerated by:

`npx devcert-cli generate snowpack`


